<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - La Casa del Gadget</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    
    <!-- SIDEBAR DINÁMICO SEGÚN ROL -->
    <div class="sidebar">
        <h2>Gadget Admin</h2>
        <ul>
            <li><a href="{{ url_for('main.admin_dashboard') }}" class="active"><i class="fas fa-home"></i> Resumen</a></li>
            
            <!-- TODOS ven productos -->
            <li><a href="{{ url_for('main.admin_productos') }}"><i class="fas fa-box"></i> Inventario</a></li>
            
            <!-- SOLO ADMIN ve Gestión de Usuarios -->
            {% if session.get('user_rol') == 'admin' %}
            <li><a href="{{ url_for('main.admin_usuarios') }}"><i class="fas fa-users-cog"></i> Usuarios Staff</a></li>
            {% endif %}

            <!-- Enlaces Comunes -->
            <li><a href="{{ url_for('main.index') }}" target="_blank"><i class="fas fa-globe"></i> Ver Tienda</a></li>
            <li><a href="{{ url_for('main.logout') }}" class="logout"><i class="fas fa-sign-out-alt"></i> Salir</a></li>
        </ul>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="main-content">
        
        <!-- Mensajes Flash (Errores/Exitos) -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert {{ category }}" style="padding: 10px; margin-bottom: 20px; background: #fff; border-left: 4px solid var(--verde); box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <header class="header-admin">
            <div>
                <h1>Hola, {{ session.get('username')|capitalize }}</h1>
                <p style="color: #666;">Rol: <strong>{{ session.get('user_rol')|upper }}</strong></p>
            </div>
            <div class="date-display">
                {{ datos.fecha_hoy }}
            </div>
        </header>

        <!-- TARJETAS DE MÉTRICAS (KPIs) -->
        <div class="cards-grid">
            <!-- Ventas: Visible para Admin y Gerente -->
            {% if session.get('user_rol') in ['admin', 'gerente'] %}
            <div class="card-stat">
                <h3><i class="fas fa-dollar-sign"></i> Ventas del Día</h3>
                <p>${{ "{:,.2f}".format(datos.ventas_dia) }}</p>
            </div>
            <div class="card-stat">
                <h3><i class="fas fa-trophy"></i> Empleado del Mes</h3>
                <p style="font-size: 1.2rem;">{{ datos.empleado_mes }}</p>
            </div>
            {% endif %}

            <!-- Citas: Visible para Todos -->
            <div class="card-stat">
                <h3><i class="far fa-calendar-check"></i> Citas Pendientes</h3>
                <p>{{ datos.citas_pendientes }}</p>
            </div>

            <!-- Stock: Alerta Roja -->
            <div class="card-stat" style="border-left-color: var(--rojo-alerta);">
                <h3><i class="fas fa-exclamation-triangle"></i> Stock Bajo</h3>
                <p>{{ datos.stock_bajo }} Productos</p>
            </div>
        </div>

        <!-- TABLAS DE DATOS -->
        <div class="dashboard-tables" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            
            <!-- Tabla 1: Últimas Ventas (Admin/Gerente) -->
            {% if session.get('user_rol') in ['admin', 'gerente'] %}
            <div class="table-container">
                <h3><i class="fas fa-shopping-bag"></i> Últimas Ventas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Vendedor</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for venta in ventas %}
                        <tr>
                            <td>{{ venta.fecha }}</td>
                            <td>{{ venta.vendedor }}</td>
                            <td style="color: var(--verde); font-weight: bold;">${{ "{:,.0f}".format(venta.total) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}

            <!-- Tabla 2: Próximas Citas (Todos) -->
            <div class="table-container">
                <h3><i class="fas fa-clock"></i> Próximas Citas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Cliente</th>
                            <th>Producto</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cita in citas %}
                        <tr>
                            <td>{{ cita.fecha }}</td>
                            <td>{{ cita.cliente }}</td>
                            <td>{{ cita.producto }}</td>
                            <td>
                                <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; background: {{ '#e8f5e9' if cita.estado == 'Confirmada' else '#fff3e0' }}; color: {{ '#1D5A45' if cita.estado == 'Confirmada' else '#D97752' }};">
                                    {{ cita.estado }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
    </div>

</body>
</html>