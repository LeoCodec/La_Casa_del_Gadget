{% extends 'base.html' %}
{% block title %}Carrito - La Casa del Gadget{% endblock %}

{% block content %}
<div class="cart-page">
  <div class="cart-header">
    <h1>Carrito de Compras</h1>
    <a class="cart-continue-link" href="{{ url_for('main.productos_listado') }}">Seguir comprando</a>
  </div>

  {% if carrito and carrito|length > 0 %}
    <div class="cart-grid">

      <!-- Lista -->
      <section class="cart-list">
        {% for item in carrito %}
        <article class="cart-item">
          <div class="cart-item-img">
            <img src="{{ item.url_imagen }}" alt="{{ item.nombre }}">
          </div>

          <div class="cart-item-info">
            <div class="cart-item-brand">{{ item.marca }}</div>
            <div class="cart-item-name">{{ item.nombre }}</div>

            <div class="cart-item-actions">
              <form class="cart-qty" method="POST" action="{{ url_for('main.actualizar_carrito', producto_id=item.id) }}">
                <button type="submit" name="accion" value="restar" class="cart-qty-btn" aria-label="Restar">−</button>
                <span class="cart-qty-val">{{ item.cantidad }}</span>
                <button type="submit" name="accion" value="sumar" class="cart-qty-btn" aria-label="Sumar">+</button>
              </form>

              <form method="POST" action="{{ url_for('main.eliminar_carrito', producto_id=item.id) }}">
                <button type="submit" class="cart-remove" title="Eliminar">
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </div>
          </div>

          <div class="cart-item-total">
            ${{ "{:,.0f}".format(item.precio * item.cantidad) }}
          </div>
        </article>
        {% endfor %}
      </section>

      <!-- Resumen -->
      <aside class="cart-summary">
        <h2>Resumen del Pedido</h2>

        <div class="cart-line">
          <span>Subtotal</span>
          <span>${{ "{:,.0f}".format(subtotal) }}</span>
        </div>

        <div class="cart-line">
          <span>Envío</span>
          <span class="cart-free">Gratis</span>
        </div>

        <hr class="cart-hr">

        <div class="cart-total">
          <span>Total</span>
          <span>${{ "{:,.0f}".format(total) }}</span>
        </div>

        <form method="POST" action="{{ url_for('main.pagar') }}">
          <button type="submit" class="btn-submit">Proceder al Pago</button>
        </form>

        <a href="{{ url_for('main.productos_listado') }}" class="btn-nav btn-secondary cart-secondary">
          Continuar Comprando
        </a>
      </aside>

    </div>

  {% else %}
    <div class="cart-empty">
      <h2>Tu carrito está vacío</h2>
      <p>Agrega productos para verlos aquí.</p>
      <a href="{{ url_for('main.productos_listado') }}" class="btn-submit">Ir a la tienda</a>
    </div>
  {% endif %}
</div>
{% endblock %}
